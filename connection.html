<html>

<head>
    <script src="integ/comm.js"></script>
    <script src="integ/md5.js"></script>
    <script src="integ/base64.js"></script>
    <script src="integ/jnrWebsocket.js"></script>
</head>

<body>

    <pre id="status">&nbsp;</pre>

    <button id="connect-button" onclick="connect_button_click()">Connect</button>
    <button id="close-button" onclick="close_button_click()" disabled="disabled">Close</button>


    <script>

        const connect_button = document.getElementById('connect-button');
        const close_button = document.getElementById('close-button');

        function updateStatus(text, color) {
            var statusElement = document.getElementById('status');
            statusElement.innerText = text;
            statusElement.style.color = color;
        }



        //
        // get the ip address from the url.  if one is not specifed then prompt the user for it
        let params = (new URL(document.location)).searchParams;
        let ip = params.get("ip");
        if (!ip) ip = prompt("Please enter the target IP Address");


        //
        // define our websocket object
        var jnrwebsocket = new JnrWebsocket();


        //
        // add a couple connection listeners for our jnrWebsocket object.  when these listeners 
        // are called we will update our status element
        jnrwebsocket.addEventListener('onOpened', () => {
            updateStatus('Connected!', 'green');

            // we are connected, enable the close button
            close_button.disabled = false;
        });

        jnrwebsocket.addEventListener('onClosed', () => {
            updateStatus('Closed!', 'red');

            // we are disconnected, enable the connect button
            connect_button.disabled = false;
        });

        jnrwebsocket.onError = (error) => {
            updateStatus(`websocket connection has thrown an error: ${error}`, 'red');
        };


        // gets called when the user clicks the connect button
        function connect_button_click() {
            updateStatus(`Connecting to ${ip}...`, 'black');
            jnrwebsocket.connect('ws://' + ip);

            // we are connecting, disable the connect button
            connect_button.disabled = true;
        }


        // gets called when the user clicks the close button
        function close_button_click() {
            updateStatus(`Closing...`, 'black');
            jnrwebsocket.close();

            // we are disconnecting, disable the close button
            close_button.disabled = true;
        }

    </script>


    <!-- <script src="test.js"></script> -->

</body>

</html>