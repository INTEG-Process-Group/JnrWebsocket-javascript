<html>

<head>
    <script src="integ/comm.js"></script>
    <script src="integ/md5.js"></script>
    <script src="integ/base64.js"></script>
    <script src="integ/jnrWebsocket.js"></script>
</head>

<body>

    <pre id="status">&nbsp;</pre>

    <script>
        function updateStatus(text, color) {
            var statusElement = document.getElementById('status');
            statusElement.innerText = text;
            statusElement.style.color = color;
        }



        //
        // get the ip address from the url.  if one is not specifed then prompt the user for it
        let params = (new URL(document.location)).searchParams;
        let ip = params.get("ip");
        if (!ip) ip = prompt("Please enter the target IP Address");


        //
        // define our websocket object
        var jnrwebsocket = new JnrWebsocket();

        //
        // a flag that knows if we are connected
        var _connected = false;


        //
        // add a couple connection listeners for our jnrWebsocket object.  when these listeners 
        // are called we will update our status element
        jnrwebsocket.addEventListener('onOpened', () => {
            updateStatus('Connected!', 'green');
            _connected = true;
        });

        jnrwebsocket.addEventListener('onClosed', () => {
            updateStatus('Closed!', 'red');
            _connected = false;
        });

        jnrwebsocket.onError = (error) => {
            updateStatus(`websocket connection has thrown an error: ${error}`, 'red');
        };


        // gets called when the user clicks the connect button
        function connect_button_click() {
            //
            // check to see if we are connected and if we are then close the connection
            if (_connected) {
                updateStatus(`WebScoket is already connected!`, 'red');
            } else {
                updateStatus(`Connecting to ${ip}...`, 'black');
                jnrwebsocket.connect('ws://' + ip);
            }
        }


        // gets called when the user clicks the close button
        function close_button_click() {
            //
            // check to see if we are connected and if we are then close the connection
            if (_connected) {
                updateStatus(`Closing...`, 'black');
                jnrwebsocket.close();
            } else {
                updateStatus(`WebSocket is not open`, 'red');
            }
        }

    </script>


    <button onclick="connect_button_click()">Connect</button>
    <button onclick="close_button_click()">Close</button>

    <script src="test.js"></script>

</body>

</html>